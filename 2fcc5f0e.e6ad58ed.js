(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{63:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return o})),a.d(t,"metadata",(function(){return i})),a.d(t,"rightToc",(function(){return l})),a.d(t,"default",(function(){return d}));var n=a(2),r=a(6),c=(a(0),a(85)),o={id:"garbage-collection",title:"Garbage Collection and Eviction",sidebar_label:"Garbage Collection & Eviction"},i={unversionedId:"garbage-collection",id:"garbage-collection",isDocsHomePage:!1,title:"Garbage Collection and Eviction",description:"Ferry enables you to selectively remove cached data that is no longer useful. The default garbage collection strategy of the Cache.gc() method is suitable for most applications, but the Cache.evict() method provides more fine-grained control for applications that require it.",source:"@site/../docs/garbage-collection.md",slug:"/garbage-collection",permalink:"/docs/garbage-collection",editUrl:"https://github.com/gql-dart/ferry/edit/master/docs/../docs/garbage-collection.md",version:"current",sidebar_label:"Garbage Collection & Eviction",sidebar:"mainSidebar",previous:{title:"Reading and Writing Data to the Cache",permalink:"/docs/cache-interaction"},next:{title:"Using with Flutter",permalink:"/docs/flutter"}},l=[{value:"<code>Cache.gc()</code>",id:"cachegc",children:[{value:"Configuring garbage collection",id:"configuring-garbage-collection",children:[]}]},{value:"<code>Cache.evict()</code>",id:"cacheevict",children:[]}],b={rightToc:l};function d(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(c.b)("wrapper",Object(n.a)({},b,a,{components:t,mdxType:"MDXLayout"}),Object(c.b)("p",null,"Ferry enables you to selectively remove cached data that is no longer useful. The default garbage collection strategy of the ",Object(c.b)("inlineCode",{parentName:"p"},"Cache.gc()")," method is suitable for most applications, but the ",Object(c.b)("inlineCode",{parentName:"p"},"Cache.evict()")," method provides more fine-grained control for applications that require it."),Object(c.b)("h2",{id:"cachegc"},Object(c.b)("inlineCode",{parentName:"h2"},"Cache.gc()")),Object(c.b)("p",null,"The ",Object(c.b)("inlineCode",{parentName:"p"},"gc()")," method removes all objects from the normalized cache that are not ",Object(c.b)("strong",{parentName:"p"},"reachable"),":"),Object(c.b)("pre",null,Object(c.b)("code",Object(n.a)({parentName:"pre"},{className:"language-dart"}),"final cache = Cache();\n\ncache.gc();\n")),Object(c.b)("p",null,"To determine whether an object is reachable, the cache starts from all known root objects and uses a tracing strategy to recursively visit all available child references. Any normalized objects that are ",Object(c.b)("em",{parentName:"p"},"not")," visited during this process are removed. The ",Object(c.b)("inlineCode",{parentName:"p"},"gc()")," method returns a Set of the IDs of the removed objects."),Object(c.b)("h3",{id:"configuring-garbage-collection"},"Configuring garbage collection"),Object(c.b)("p",null,"You can use the ",Object(c.b)("inlineCode",{parentName:"p"},"retain()")," method to prevent an object (and its children) from being garbage collected, even if the object isn't reachable:"),Object(c.b)("pre",null,Object(c.b)("code",Object(n.a)({parentName:"pre"},{className:"language-dart"}),"cache.retain('my-object-id');\n")),Object(c.b)("p",null,"If you later want a retained object to be garbage collected, use the ",Object(c.b)("inlineCode",{parentName:"p"},"release()")," method:"),Object(c.b)("pre",null,Object(c.b)("code",Object(n.a)({parentName:"pre"},{className:"language-dart"}),"cache.release('my-object-id');\n")),Object(c.b)("p",null,"If the object is unreachable, it will be garbage collected during next call to ",Object(c.b)("inlineCode",{parentName:"p"},"gc()"),"."),Object(c.b)("h2",{id:"cacheevict"},Object(c.b)("inlineCode",{parentName:"h2"},"Cache.evict()")),Object(c.b)("p",null,"You can remove any normalized object from the cache using the ",Object(c.b)("inlineCode",{parentName:"p"},"evict()")," method:"),Object(c.b)("pre",null,Object(c.b)("code",Object(n.a)({parentName:"pre"},{className:"language-dart"}),"cache.evict('my-object-id');\n")),Object(c.b)("p",null,"You can also remove a ",Object(c.b)("em",{parentName:"p"},"single field")," from a cached object by providing the name of the field to remove:"),Object(c.b)("pre",null,Object(c.b)("code",Object(n.a)({parentName:"pre"},{className:"language-dart"}),"cache.evict('my-object-id', fieldName: 'yearOfFounding');\n")),Object(c.b)("p",null,"Evicting an object often makes ",Object(c.b)("em",{parentName:"p"},"other")," cached objects unreachable. Because of this, you should call ",Object(c.b)("a",Object(n.a)({parentName:"p"},{href:"#cachegc"}),Object(c.b)("inlineCode",{parentName:"a"},"gc()"))," after evicting one or more objects from the cache."))}d.isMDXComponent=!0},85:function(e,t,a){"use strict";a.d(t,"a",(function(){return p})),a.d(t,"b",(function(){return g}));var n=a(0),r=a.n(n);function c(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){c(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},c=Object.keys(e);for(n=0;n<c.length;n++)a=c[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(n=0;n<c.length;n++)a=c[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var b=r.a.createContext({}),d=function(e){var t=r.a.useContext(b),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=d(e.components);return r.a.createElement(b.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},s=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,c=e.originalType,o=e.parentName,b=l(e,["components","mdxType","originalType","parentName"]),p=d(a),s=n,g=p["".concat(o,".").concat(s)]||p[s]||u[s]||c;return a?r.a.createElement(g,i(i({ref:t},b),{},{components:a})):r.a.createElement(g,i({ref:t},b))}));function g(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var c=a.length,o=new Array(c);o[0]=s;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:n,o[1]=i;for(var b=2;b<c;b++)o[b]=a[b];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,a)}s.displayName="MDXCreateElement"}}]);