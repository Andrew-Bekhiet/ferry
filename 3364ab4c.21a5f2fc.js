(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{64:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return o})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return p}));var a=n(2),r=n(6),i=(n(0),n(85)),o={id:"pagination",title:"Pagination & Refetching"},c={unversionedId:"pagination",id:"pagination",isDocsHomePage:!1,title:"Pagination & Refetching",description:"Fetching new data for an OperationRequest in Ferry is as easy as adding an updated request to the Client.requestController. Ferry will automatically include the results from the updated request in the response Stream of the original request if:",source:"@site/../docs/pagination.md",slug:"/pagination",permalink:"/docs/pagination",editUrl:"https://github.com/gql-dart/ferry/edit/master/docs/../docs/pagination.md",version:"current",sidebar:"mainSidebar",previous:{title:"Fetch Policies",permalink:"/docs/fetch-policies"},next:{title:"Error Handling",permalink:"/docs/error-handling"}},l=[{value:"Refetching",id:"refetching",children:[]},{value:"Pagination",id:"pagination",children:[]}],s={rightToc:l};function p(e){var t=e.components,n=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},s,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("p",null,"Fetching new data for an ",Object(i.b)("inlineCode",{parentName:"p"},"OperationRequest")," in Ferry is as easy as adding an updated request to the ",Object(i.b)("inlineCode",{parentName:"p"},"Client.requestController"),". Ferry will automatically include the results from the updated request in the response Stream of the original request if:"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},"The updated request is identical to the original request, OR"),Object(i.b)("li",{parentName:"ol"},"The updated request has the same (non-null) ",Object(i.b)("inlineCode",{parentName:"li"},"requestId")," as the original request")),Object(i.b)("h2",{id:"refetching"},"Refetching"),Object(i.b)("p",null,"For example, if we are listening to the following request:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-dart"}),"final reviewsReq = GReviewsReq(\n  (b) => b\n    ..vars.first = 3\n    ..vars.offset = 0,\n);\n\nclient.request(reviewsReq).listen((response) => print(response));\n")),Object(i.b)("p",null,"We can refetch the query by adding the same request to the ",Object(i.b)("inlineCode",{parentName:"p"},"requestController"),":"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-dart"}),"client.requestController.add(reviewsReq);\n")),Object(i.b)("p",null,"Once the response is received, any ",Object(i.b)("inlineCode",{parentName:"p"},"request()")," Streams that were listening to ",Object(i.b)("inlineCode",{parentName:"p"},"reviewsReq")," will get updated with the new data. "),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"Since refetching doesn't override the ",Object(i.b)("inlineCode",{parentName:"p"},"FetchPolicy")," setting, if ",Object(i.b)("inlineCode",{parentName:"p"},"FetchPolicy")," is set to ",Object(i.b)("inlineCode",{parentName:"p"},"CacheFirst"),", you'll get the cached results of the initial operation."))),Object(i.b)("h2",{id:"pagination"},"Pagination"),Object(i.b)("p",null,"Rather than just replacing the previous result with the refetched result, we may want to combine the results to enable pagination."),Object(i.b)("p",null,"To do this, we first need to update our original request to include a ",Object(i.b)("inlineCode",{parentName:"p"},"requestId"),". This will tell Ferry to include any results from subsequent requests with the same ",Object(i.b)("inlineCode",{parentName:"p"},"requestId")," in this request's result stream."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-dart",metastring:"{3}","{3}":!0}),"final reviewsReq = GReviewsReq(\n  (b) => b\n    ..requestId = 'MyReviewsReq'\n    ..vars.first = 3\n    ..vars.offset = 0,\n);\n\nclient.request(reviewsReq).listen((response) => print(response));\n")),Object(i.b)("p",null,"Now we can create a copy of our request that will fetch the next set of results and include an ",Object(i.b)("inlineCode",{parentName:"p"},"updateResult")," calback that tells ferry how to combine the results."),Object(i.b)("p",null,"For example, let's fetch the next 3 reviews."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{className:"language-dart"}),"final nextReviewsReq = reviewsReq.rebuild(\n  (b) => b\n    ..vars.offset = 3\n    ..updateResult = (previous, result) =>\n        previous?.rebuild((b) => b..reviews.addAll(result.reviews)) ??\n        result,\n);\n\nclient.requestController.add(nextReviewsReq);\n")),Object(i.b)("div",{className:"admonition admonition-note alert alert--secondary"},Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-heading"}),Object(i.b)("h5",{parentName:"div"},Object(i.b)("span",Object(a.a)({parentName:"h5"},{className:"admonition-icon"}),Object(i.b)("svg",Object(a.a)({parentName:"span"},{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"}),Object(i.b)("path",Object(a.a)({parentName:"svg"},{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})))),"note")),Object(i.b)("div",Object(a.a)({parentName:"div"},{className:"admonition-content"}),Object(i.b)("p",{parentName:"div"},"Since we are using the ",Object(i.b)("inlineCode",{parentName:"p"},"rebuild()")," method, our ",Object(i.b)("inlineCode",{parentName:"p"},"newsReviewsReq")," will copy the ",Object(i.b)("inlineCode",{parentName:"p"},"requestId")," we defined in ",Object(i.b)("inlineCode",{parentName:"p"},"reviewsReq")," above automatically. Otherwise, we'd need to specify the ",Object(i.b)("inlineCode",{parentName:"p"},"requestId")," manuallly."))),Object(i.b)("p",null,"The next event received by our ",Object(i.b)("inlineCode",{parentName:"p"},"request()")," Stream will now include all six reviews."))}p.isMDXComponent=!0},85:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return m}));var a=n(0),r=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=r.a.createContext({}),p=function(e){var t=r.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},b=function(e){var t=p(e.components);return r.a.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},u=r.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,o=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),b=p(n),u=a,m=b["".concat(o,".").concat(u)]||b[u]||d[u]||i;return n?r.a.createElement(m,c(c({ref:t},s),{},{components:n})):r.a.createElement(m,c({ref:t},s))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=u;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:a,o[1]=c;for(var s=2;s<i;s++)o[s]=n[s];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,n)}u.displayName="MDXCreateElement"}}]);