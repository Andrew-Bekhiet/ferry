<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.63">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-180710528-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="search" type="application/opensearchdescription+xml" title="Ferry Graphql" href="/ferry/opensearch.xml"><title data-react-helmet="true">Mutations | Ferry Graphql</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Mutations | Ferry Graphql"><meta data-react-helmet="true" name="description" content="Mutations are executed exactly the same way as queries:"><meta data-react-helmet="true" property="og:description" content="Mutations are executed exactly the same way as queries:"><meta data-react-helmet="true" property="og:url" content="https://ferrygraphql.com/ferry/docs/mutations"><link data-react-helmet="true" rel="shortcut icon" href="/ferry/img/favicon.ico"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="true"><link data-react-helmet="true" rel="canonical" href="https://ferrygraphql.com/ferry/docs/mutations"><link rel="stylesheet" href="/ferry/styles.b24e737a.css">
<link rel="preload" href="/ferry/styles.81b9196f.js" as="script">
<link rel="preload" href="/ferry/runtime~main.a6fe4d32.js" as="script">
<link rel="preload" href="/ferry/main.1ca66f12.js" as="script">
<link rel="preload" href="/ferry/1.656d252f.js" as="script">
<link rel="preload" href="/ferry/2.32e74d0d.js" as="script">
<link rel="preload" href="/ferry/26.a1fc5010.js" as="script">
<link rel="preload" href="/ferry/29.a43c1fb4.js" as="script">
<link rel="preload" href="/ferry/935f2afb.24bb2130.js" as="script">
<link rel="preload" href="/ferry/17896441.5039ad5d.js" as="script">
<link rel="preload" href="/ferry/28e8e720.1c1af2f8.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/ferry/"><img class="navbar__logo" src="/ferry/img/logo.svg" alt="Ferry Logo"><strong class="navbar__title">Ferry</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/ferry/docs/">Docs</a><a href="https://github.com/gql-dart/ferry/tree/master/examples" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Examples</a></div><div class="navbar__items navbar__items--right"><a href="https://pub.dev/packages/ferry" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">pub.dev</a><a href="https://github.com/gql-dart/ferry" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span><span class="DocSearch-Button-Key">âŒ˜</span><span class="DocSearch-Button-Key">K</span></button></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/ferry/"><img class="navbar__logo" src="/ferry/img/logo.svg" alt="Ferry Logo"><strong class="navbar__title">Ferry</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/ferry/docs/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/gql-dart/ferry/tree/master/examples" target="_blank" rel="noopener noreferrer" class="menu__link">Examples</a></li><li class="menu__list-item"><a href="https://pub.dev/packages/ferry" target="_blank" rel="noopener noreferrer" class="menu__link">pub.dev</a></li><li class="menu__list-item"><a href="https://github.com/gql-dart/ferry" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Ferry</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ferry/docs/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ferry/docs/how-it-works">How It Works</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Getting Started</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ferry/docs/setup">Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ferry/docs/codegen">Generate Classes</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Fetching</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/ferry/docs/queries">Queries</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/ferry/docs/mutations">Mutations</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/ferry/docs/fetch-policies">Fetch Policies</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/ferry/docs/pagination">Pagination &amp; Refetching</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/ferry/docs/error-handling">Error Handling</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Caching</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ferry/docs/cache-configuration">Configuration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ferry/docs/cache-interaction">Reading and Writing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ferry/docs/garbage-collection">Garbage Collection &amp; Eviction</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Flutter</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ferry/docs/flutter">Using with Flutter</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ferry/docs/flutter-operation-widget">Operation Widget</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ferry/docs/structuring-queries">Structuring Queries</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Advanced</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ferry/docs/custom-scalars">Custom Scalars</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/ferry/docs/customization">Customizing the Client</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Mutations</h1></header><div class="markdown"><p>Mutations are executed exactly the same way as <a href="/ferry/docs/queries">queries</a>:</p><ol><li>Create an instance of the <a href="/ferry/docs/codegen">generated</a> request class for your Mutation.</li><li>Call <code>Client.request()</code> with your request instance.</li><li>Listen to the returned Stream.</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="creating-a-request"></a>Creating a Request<a aria-hidden="true" tabindex="-1" class="hash-link" href="#creating-a-request" title="Direct link to heading">#</a></h3><p>Let&#x27;s assume we&#x27;ve created a <code>CreateReview</code> Mutation in a file named <code>create_review.graphql</code>.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-graphql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># create_review.graphql</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">mutation</span><span class="token plain"> CreateReview</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token variable" style="color:rgb(191, 199, 213)">$review</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> ReviewInput</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  createReview</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token attr-name" style="color:rgb(255, 203, 107)">review</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">$review</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    id</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    stars</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    commentary</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>In this case, the review depends on <code>ReviewInput</code> which is defined in our schema:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-graphql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># schema.graphql</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">input</span><span class="token plain"> ReviewInput </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 0-5 stars</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token attr-name" style="color:rgb(255, 203, 107)">stars</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Int</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Comment about the movie, optional</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token attr-name" style="color:rgb(255, 203, 107)">commentary</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> String</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>Running the Ferry <a href="/ferry/docs/codegen">generator</a> will create a <code>create_review.req.gql.dart</code> file with a Class named <code>GCreateReviewReq</code>. We can instantiate it like this:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">final createReviewReq = GCreateReviewReq(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (b) =&gt; b</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ..vars.review.stars = 5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ..vars.review.commentary = &quot;Amazing!!!&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="listening-to-the-request-stream"></a>Listening to the Request Stream<a aria-hidden="true" tabindex="-1" class="hash-link" href="#listening-to-the-request-stream" title="Direct link to heading">#</a></h3><p>Now we can execute the mutation and listen for a response like so:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">client.request(createReviewReq).listen((response) =&gt; print(response));</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="optimistic-updates"></a>Optimistic Updates<a aria-hidden="true" tabindex="-1" class="hash-link" href="#optimistic-updates" title="Direct link to heading">#</a></h2><p>We often want our users to be able to see changes they make within our applications instantly.</p><p>To achieve this, we can provide our <code>OperationRequest</code> with an <code>optimisticResponse</code>, which will trigger an <code>OperationResponse</code> that includes the optimistic data immediately. Then, once the network response is received from the server, a second <code>OperationResponse</code> will be triggered with the network data.</p><p>Using the example above, we could include an optimistic response like so:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">final createReviewReq = GCreateReviewReq(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (b) =&gt; b</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ..vars.review.stars = 5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ..vars.review.commentary = &quot;Amazing!!!&quot;</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    ..optimisticResponse.createReview.id = &quot;__optimistic__&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ..optimisticResponse.createReview.stars = 5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ..optimisticResponse.createReview.commentary = &quot;Amazing!!!&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="updating-the-cache"></a>Updating the Cache<a aria-hidden="true" tabindex="-1" class="hash-link" href="#updating-the-cache" title="Direct link to heading">#</a></h2><p>Sometimes we need to update the cache in response to a mutation. Ferry allows arbitrary cache updates following any Operation using <code>UpdateCacheHandler</code> callbacks, which run whenever an <code>OperationResponse</code> is received.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">typedef UpdateCacheHandler&lt;TData, TVars&gt; = void Function(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  CacheProxy proxy,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  OperationResponse&lt;TData, TVars&gt; response,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div></div></div></div></div><p>The <code>CacheProxy</code> passed to the handler includes methods to read &amp; write data to &amp; from the cache, including <code>readQuery</code>, <code>readFragment</code>, <code>writeQuery</code> and <code>writeFragment</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="creating-an-updatecachehandler"></a>Creating an <code>UpdateCacheHandler</code><a aria-hidden="true" tabindex="-1" class="hash-link" href="#creating-an-updatecachehandler" title="Direct link to heading">#</a></h3><p>Continuing our example from above, we may want to update our<a href="/ferry/docs/queries#creating-a-request"> <code>Reviews</code></a> Query with the result of executing the <code>CreateReview</code> Mutation. To do so, we&#x27;d write the following <code>UpdateCacheHandler</code>:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">import &#x27;./graphql/create_review.data.gql.dart&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import &#x27;./graphql/create_review.var.gql.dart&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">UpdateCacheHandler&lt;GCreateReviewData, GCreateReviewVars&gt; createReviewHandler = (</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  proxy,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  response,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  final reviews = proxy.readQuery(reviewsReq) ?? GReviewsData();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  proxy.writeQuery(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    reviewsReq,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    reviews.rebuild(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      (b) =&gt; b</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ..reviews.add(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          GReviewsData_reviews.fromJson(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            response.data.createReview.toJson(),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          ),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div></div></div></div></div><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Since Dart doesn&#x27;t yet have algebraic data types, to avoid receiving a type error we must convert our <code>GCreateReviewData</code> to Json, then convert it back from Json to a <code>GReviewsData_reviews</code> type before adding it to our reviews list.</p></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="passing-handlers-to-the-client"></a>Passing Handlers to the Client<a aria-hidden="true" tabindex="-1" class="hash-link" href="#passing-handlers-to-the-client" title="Direct link to heading">#</a></h3><p>If Ferry, the client must be aware of all <code>UpdateCacheHandler</code>s. This is slightly different from how other GraphQL clients (like Apollo) work, but it&#x27;s necessary to enable features such as offline mutations.</p><p>Now that we&#x27;ve created our <code>createReviewHandler</code>, we can add it to our Client using the key <code>&quot;createReviewHandler&quot;</code>, which we&#x27;ll later use to trigger this handler from our mutation request.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">import &#x27;package:gql_http_link/gql_http_link.dart&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import &#x27;package:ferry/ferry.dart&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import &#x27;package:ferry/plugins.dart&#x27;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">final link = HttpLink(&quot;[path/to/endpoint]&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">final client = Client(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  link: link,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cache: cache,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  updateCacheHandlers: {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &#x27;createReviewHandler&#x27;: createReviewHandler,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div></div></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="triggering-a-handler"></a>Triggering a Handler<a aria-hidden="true" tabindex="-1" class="hash-link" href="#triggering-a-handler" title="Direct link to heading">#</a></h3><p>Now we can tell Ferry to trigger our handler when it receives an <code>OperationResponse</code> for our mutation.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">final createReviewReq = GCreateReviewReq(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (b) =&gt; b</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ..vars.review.stars = 5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ..vars.review.commentary = &quot;Amazing!!!&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ..optimisticResponse.createReview.id = &quot;__optimistic__&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ..optimisticResponse.createReview.stars = 5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ..optimisticResponse.createReview.commentary = &quot;Amazing!!!&quot;</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    ..updateCacheHandlerKey = &quot;createReviewHandler&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div></div></div></div></div><p>Since our mutation request includes an optimistic response, our handler will first be run as an optimistic patch using the optimistic data. When the network response is received from the server, the optimistic patch will be discarded and the handler will be run again with the response data from the network.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="passing-data-to-a-handler"></a>Passing Data to a Handler<a aria-hidden="true" tabindex="-1" class="hash-link" href="#passing-data-to-a-handler" title="Direct link to heading">#</a></h3><p>If you need to pass any contextual data to your handler, Ferry allows you to include a Json Map in your request.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">final createReviewReq = GCreateReviewReq(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (b) =&gt; b</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ..vars.review.stars = 5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ..vars.review.commentary = &quot;Amazing!!!&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ..optimisticResponse.createReview.id = &quot;__optimistic__&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ..optimisticResponse.createReview.stars = 5</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ..optimisticResponse.createReview.commentary = &quot;Amazing!!!&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ..updateCacheHandlerKey = &quot;createReviewHandler&quot;</span></div><div class="token-line docusaurus-highlight-code-line" style="color:#bfc7d5"><span class="token plain">    ..updateCacheHandlerContext = { &quot;userId&quot;: &quot;123&quot; },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div></div></div></div></div><p>The data can then be accessed from inside the handler.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-dart codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">UpdateCacheHandler&lt;GCreateReviewData, GCreateReviewVars&gt; createReviewHandler = (</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  proxy,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  response,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  final userId = response.operationRequest.updateCacheHandlerContext[&quot;userId&quot;];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  /// [Your Handler Logic]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div></div></div></div></div><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</h5></div><div class="admonition-content"><p>If you need offline mutation support, be sure to only include valid Json in the <code>updateCacheHandlerContext</code>, since this will need to be serialized</p></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/gql-dart/ferry/edit/master/docs/../docs/mutations.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/ferry/docs/queries"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Queries</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/ferry/docs/fetch-policies"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Fetch Policies Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#creating-a-request" class="table-of-contents__link">Creating a Request</a></li><li><a href="#listening-to-the-request-stream" class="table-of-contents__link">Listening to the Request Stream</a></li><li><a href="#optimistic-updates" class="table-of-contents__link">Optimistic Updates</a></li><li><a href="#updating-the-cache" class="table-of-contents__link">Updating the Cache</a><ul><li><a href="#creating-an-updatecachehandler" class="table-of-contents__link">Creating an <code>UpdateCacheHandler</code></a></li><li><a href="#passing-handlers-to-the-client" class="table-of-contents__link">Passing Handlers to the Client</a></li><li><a href="#triggering-a-handler" class="table-of-contents__link">Triggering a Handler</a></li><li><a href="#passing-data-to-a-handler" class="table-of-contents__link">Passing Data to a Handler</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/ferry/docs/">Introduction</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://discord.gg/G3JGkBY" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://pub.dev/packages/ferry" target="_blank" rel="noopener noreferrer" class="footer__link-item">pub.dev</a></li><li class="footer__item"><a href="https://github.com/gql-dart/ferry" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright Â© 2022 Sat Mandir Khalsa. Built with Docusaurus.</div></div></div></footer></div>
<script src="/ferry/styles.81b9196f.js"></script>
<script src="/ferry/runtime~main.a6fe4d32.js"></script>
<script src="/ferry/main.1ca66f12.js"></script>
<script src="/ferry/1.656d252f.js"></script>
<script src="/ferry/2.32e74d0d.js"></script>
<script src="/ferry/26.a1fc5010.js"></script>
<script src="/ferry/29.a43c1fb4.js"></script>
<script src="/ferry/935f2afb.24bb2130.js"></script>
<script src="/ferry/17896441.5039ad5d.js"></script>
<script src="/ferry/28e8e720.1c1af2f8.js"></script>
</body>
</html>